<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Loopa</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
        body{background:#fff;color:#000;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;height:100vh;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:80px 40px 60px;text-align:center;overflow:hidden}
        .illustration{width:260px;height:260px;border-radius:32px;object-fit:cover;box-shadow:0 20px 40px rgba(1,22,39,0.12);margin-bottom:60px}
        .title{font-size:2.6em;font-weight:800;line-height:1.2;margin-bottom:20px}
        .subtitle{font-size:1.2em;color:#555;line-height:1.7;max-width:90%;margin-bottom:60px}
        .btn{background:#011627;color:#fff;border:none;padding:18px 50px;font-size:1.35em;font-weight:700;border-radius:20px;cursor:pointer;box-shadow:0 12px 28px rgba(1,22,39,0.22);transition:transform .25s;width:100%;max-width:360px}
        .btn:active{transform:scale(0.96)}
    </style>
</head>
<body>
    <img class="illustration" src="https://cdn.dribbble.com/userupload/41559485/file/original-f91258332b25058c27cfad3c2901abcf.png?resize=800x600" alt="Loopa">

    <div>
        <h1 class="title">Loopa'ga<br>Xush Kelibsiz</h1>
        <p class="subtitle">Qulay va zamonaviy onlayn xarid tajribasi. Minglab mahsulotlar bir joyda.</p>
    </div>

    <button class="btn" id="startBtn">Boshlash</button>

    <script>
        if(window.Telegram&&Telegram.WebApp){Telegram.WebApp.ready();Telegram.WebApp.expand()}
        
        document.getElementById('startBtn').addEventListener('click',async()=>{
            const tg=window.Telegram.WebApp;
            const chatId=tg.initDataUnsafe?.user?.id?.toString()||"";
            const username=tg.initDataUnsafe?.user?.username||tg.initDataUnsafe?.user?.first_name||"user";
            
            if(!chatId){alert("Foydalanuvchi ma'lumotlari topilmadi.");return}
            
            try{
                const response=await fetch('https://api.loopa.buzz/api/users/login',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({chatId:chatId,username:username})
                });
                
                const result=await response.json();
                
                if(result.success && result.data?.token){
                    localStorage.setItem('token', result.data.token);
                    
                    if(result.data.newUser){
                        window.location.href='interests.html';
                    } else {
                        const role = result.data.role;
                        window.location.href = (role === 'ADMIN') ? 'admin.html' : 'dashboard.html';
                    }
                }else{
                    alert(result.message||"Kirishda xatolik.");
                }
            }catch(error){
                alert("Internet aloqasini tekshiring.");
            }
        });
    </script>
</body>
</html>